{% extends "base.html" %}
{% load static %}

{% block title %}Post Real Estate - Abigon{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/post_main.css' %}">
<style>
    .post-form-container {
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .form-group {
        margin-bottom: 1.5rem;
    }

    .required {
        color: #dc3545;
    }

    .form-control {
        display: block;
        width: 100%;
        padding: 0.5rem 0.75rem;
        font-size: 1rem;
        line-height: 1.5;
        color: #495057;
        background-color: #fff;
        border: 1px solid #ced4da;
        border-radius: 0.25rem;
        transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
    }

    .form-control:focus {
        border-color: #80bdff;
        outline: 0;
        box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
    }

    .form-control[readonly] {
        background-color: #e9ecef;
    }

    .custom-control {
        position: relative;
        display: block;
        min-height: 1.5rem;
        padding-left: 1.5rem;
    }

    .custom-control-input {
        position: absolute;
        z-index: -1;
        opacity: 0;
    }

    .custom-control-label {
        position: relative;
        margin-bottom: 0;
        vertical-align: top;
    }

    .custom-control-label::before {
        position: absolute;
        top: 0.25rem;
        left: -1.5rem;
        display: block;
        width: 1rem;
        height: 1rem;
        pointer-events: none;
        content: "";
        background-color: #fff;
        border: #adb5bd solid 1px;
    }

    .form-actions {
        margin-top: 2rem;
        text-align: right;
    }

    .btn-primary {
        color: #fff;
        background-color: #007bff;
        border-color: #007bff;
        padding: 0.5rem 1rem;
        font-size: 1rem;
        line-height: 1.5;
        border-radius: 0.25rem;
        cursor: pointer;
    }

    .btn-primary:hover {
        background-color: #0069d9;
        border-color: #0062cc;
    }
</style>
{% endblock %}

{% block content %}
<div class="post-form-container">
    <form method="post" class="post-form" id="postHomeForm">
        {% csrf_token %}

        <!-- Listing Purpose -->
        <div class="form-group">
            <label for="listing_purpose">Listing Purpose <span class="required">*</span></label>
            <select name="listing_purpose" id="listing_purpose" class="form-control" required onchange="document.getElementById('property_type').innerHTML = this.value === 'sale' ? 
                    '<option value=\'\'>Select property type</option><option value=\'houses\'>Houses</option><option value=\'apartments\'>Apartments</option><option value=\'commercial\'>Commercial</option><option value=\'other\'>Other</option>' : 
                    this.value === 'rent' ? 
                    '<option value=\'\'>Select property type</option><option value=\'houses\'>Houses</option><option value=\'apartments\'>Apartments</option><option value=\'rooms\'>Rooms</option><option value=\'commercial\'>Commercial</option><option value=\'other\'>Other</option>' : 
                    '<option value=\'\'>Select property type</option>'">
                <option value="">Select purpose</option>
                <option value="sale">Sale</option>
                <option value="rent">Rent</option>
            </select>
        </div>

        <!-- Property Type -->
        <div class="form-group">
            <label for="property_type">Property Type <span class="required">*</span></label>
            <select name="property_type" id="property_type" class="form-control" required>
                <option value="">Select property type</option>
            </select>
        </div>

        <!-- Zip Code -->
        <div class="form-group">
            <label for="zip_code">Zip Code <span class="required">*</span></label>
            <input type="text" name="zip_code" id="zip_code" class="form-control" pattern="[0-9]{5}" maxlength="5"
                required placeholder="Enter 5-digit zip code">
        </div>

        <!-- City (Auto-filled) -->
        <div class="form-group">
            <label for="city">City</label>
            <input type="text" name="city" id="city" class="form-control" readonly>
        </div>

        <!-- State (Auto-filled) -->
        <div class="form-group">
            <label for="state">State</label>
            <input type="text" name="state" id="state" class="form-control" readonly>
        </div>

        <!-- Address -->
        <div class="form-group">
            <label for="address">Address</label>
            <input type="text" name="address" id="address" class="form-control" maxlength="100"
                placeholder="Enter street address">
        </div>

        <!-- Hide Address -->
        <div class="form-group">
            <div class="custom-control custom-checkbox">
                <input type="checkbox" name="hide_address" id="hide_address" class="custom-control-input">
                <label class="custom-control-label" for="hide_address">Hide address from listings</label>
            </div>
        </div>

        <!-- Submit Button -->
        <div class="form-actions">
            <button type="submit" class="btn btn-primary" name="next_button">
                Next <i class="fas fa-arrow-right"></i>
            </button>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Simple ZIP code functionality embedded
    document.addEventListener('DOMContentLoaded', function () {
        const zipInput = document.getElementById('zip_code');
        const cityInput = document.getElementById('city');
        const stateInput = document.getElementById('state');

        if (zipInput && cityInput && stateInput) {
            let zipTimer = null;

            zipInput.addEventListener('input', function () {
                const zip = this.value.trim();
                console.log('ZIP input:', zip);

                if (!zip) {
                    cityInput.value = '';
                    stateInput.value = '';
                    return;
                }

                if (zip.length === 5 && /^\d+$/.test(zip)) {
                    if (zipTimer) clearTimeout(zipTimer);
                    zipTimer = setTimeout(() => {
                        fetchZipData(zip);
                    }, 500);
                }
            });

            async function fetchZipData(zip) {
                console.log('Fetching ZIP data for:', zip);

                try {
                    const response = await fetch(`https://api.zippopotam.us/us/${zip}`);
                    console.log('ZIP API response status:', response.status);

                    if (!response.ok) {
                        throw new Error('ZIP not found');
                    }

                    const data = await response.json();
                    console.log('ZIP API data:', data);

                    if (data.places && data.places.length > 0) {
                        const place = data.places[0];
                        cityInput.value = place['place name'];
                        stateInput.value = place['state abbreviation'];
                        console.log('ZIP data updated:', place);
                    }
                } catch (error) {
                    console.error('ZIP fetch error:', error);
                    cityInput.value = '';
                    stateInput.value = '';
                }
            }
        }
    });
</script>
{% endblock %}