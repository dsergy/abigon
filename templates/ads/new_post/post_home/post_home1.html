{% extends "ads/new_post/new_post_base.html" %}
{% load static %}

{% block sidebar_content %}
{% include "ads/new_post/sidebars/buy_rent_sidebar.html" with active_page="real_estate" %}
{% endblock %}

{% block progress_content %}
<div class="progress-container">
    <div class="progress-dot active"></div>
    <div class="progress-dot"></div>
    <div class="progress-dot"></div>
    <div class="progress-dot"></div>
    <div class="progress-dot"></div>
</div>
{% endblock %}

{% block post_content %}
<div class="post-form-container">
    <form method="post" class="post-form" id="postHomeForm">
        {% csrf_token %}

        <!-- Listing Purpose -->
        <div class="form-group">
            <label for="listing_purpose">Listing Purpose <span class="required">*</span></label>
            <select name="listing_purpose" id="listing_purpose" class="form-control" required>
                <option value="">Select purpose</option>
                <option value="sale">Sale</option>
                <option value="rent">Rent</option>
            </select>
        </div>

        <!-- Property Type -->
        <div class="form-group">
            <label for="property_type">Property Type <span class="required">*</span></label>
            <select name="property_type" id="property_type" class="form-control" required>
                <option value="">Select property type</option>
            </select>
        </div>

        <!-- Location Fields -->
        <div class="form-row">
            <div class="form-group col-md-4">
                <label for="zip_code">Zip Code <span class="required">*</span></label>
                <input type="text" name="zip_code" id="zip_code" class="form-control" pattern="[0-9]{5}" maxlength="5"
                    required placeholder="Enter 5-digit zip code">
            </div>
            <div class="form-group col-md-4">
                <label for="city">City</label>
                <input type="text" name="city" id="city" class="form-control" readonly>
            </div>
            <div class="form-group col-md-4">
                <label for="state">State</label>
                <input type="text" name="state" id="state" class="form-control" readonly>
            </div>
        </div>

        <!-- Address -->
        <div class="form-group">
            <label for="address">Address</label>
            <input type="text" name="address" id="address" class="form-control" maxlength="100"
                placeholder="Enter street address">
        </div>

        <!-- Hide Address -->
        <div class="form-group">
            <div class="custom-control custom-checkbox">
                <input type="checkbox" name="hide_address" id="hide_address" class="custom-control-input">
                <label class="custom-control-label" for="hide_address">
                    Hide address from listings
                </label>
            </div>
        </div>

        <!-- Next Button -->
        <div class="form-actions">
            <button type="submit" class="btn btn-primary" id="next_button">
                Next <i class="fas fa-arrow-right"></i>
            </button>
        </div>
    </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const listingPurpose = document.getElementById('listing_purpose');
        const propertyType = document.getElementById('property_type');
        const zipCode = document.getElementById('zip_code');
        const city = document.getElementById('city');
        const state = document.getElementById('state');

        // Property type options based on listing purpose
        const propertyTypes = {
            sale: [
                { value: 'houses', label: 'Houses' },
                { value: 'apartments', label: 'Apartments' },
                { value: 'commercial', label: 'Commercial' },
                { value: 'other', label: 'Other' }
            ],
            rent: [
                { value: 'houses', label: 'Houses' },
                { value: 'apartments', label: 'Apartments' },
                { value: 'rooms', label: 'Rooms' },
                { value: 'commercial', label: 'Commercial' },
                { value: 'other', label: 'Other' }
            ]
        };

        // Function to update property type options
        function updatePropertyTypes() {
            const purpose = listingPurpose.value;
            propertyType.innerHTML = '<option value="">Select property type</option>';

            if (purpose && propertyTypes[purpose]) {
                propertyTypes[purpose].forEach(option => {
                    const opt = document.createElement('option');
                    opt.value = option.value;
                    opt.textContent = option.label;
                    propertyType.appendChild(opt);
                });
            }
        }

        // Update property type options when listing purpose changes
        listingPurpose.addEventListener('change', updatePropertyTypes);

        // Auto-fill city and state based on zip code
        zipCode.addEventListener('blur', function () {
            if (this.value.length === 5) {
                fetch(`/api/location/${this.value}/`)
                    .then(response => response.json())
                    .then(data => {
                        city.value = data.city;
                        state.value = data.state;
                    })
                    .catch(error => {
                        console.error('Error fetching location data:', error);
                    });
            }
        });

        // Form validation
        document.getElementById('postHomeForm').addEventListener('submit', function (e) {
            e.preventDefault();
            // Add your form validation logic here
            // If validation passes, submit the form
            this.submit();
        });
    });
</script>

<style>
    .post-form-container {
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
    }

    .form-group {
        margin-bottom: 1.5rem;
    }

    .form-row {
        display: flex;
        flex-wrap: wrap;
        margin-right: -10px;
        margin-left: -10px;
    }

    .form-group.col-md-4 {
        flex: 0 0 33.333333%;
        max-width: 33.333333%;
        padding: 0 10px;
    }

    .required {
        color: #dc3545;
    }

    .form-control {
        display: block;
        width: 100%;
        padding: 0.5rem 0.75rem;
        font-size: 1rem;
        line-height: 1.5;
        color: #495057;
        background-color: #fff;
        border: 1px solid #ced4da;
        border-radius: 0.25rem;
        transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
    }

    .form-control:focus {
        border-color: #80bdff;
        outline: 0;
        box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
    }

    .form-control[readonly] {
        background-color: #e9ecef;
    }

    .custom-control {
        position: relative;
        display: block;
        min-height: 1.5rem;
        padding-left: 1.5rem;
    }

    .custom-control-input {
        position: absolute;
        z-index: -1;
        opacity: 0;
    }

    .custom-control-label {
        position: relative;
        margin-bottom: 0;
        vertical-align: top;
    }

    .form-actions {
        margin-top: 2rem;
        text-align: right;
    }

    .btn-primary {
        color: #fff;
        background-color: #007bff;
        border-color: #007bff;
        padding: 0.5rem 1rem;
        font-size: 1rem;
        line-height: 1.5;
        border-radius: 0.25rem;
        transition: all 0.15s ease-in-out;
    }

    .btn-primary:hover {
        background-color: #0069d9;
        border-color: #0062cc;
    }

    .btn-primary i {
        margin-left: 0.5rem;
    }
</style>
{% endblock %}